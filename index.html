<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Interactive Subtitles</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #video-container { position: relative; max-width: 800px; margin: auto; }
    #subtitle-box {
      position: absolute;
      bottom: 60px;
      width: 100%;
      text-align: center;
      color: white;
      font-size: 1.2em;
      text-shadow: 0px 0px 5px black;
    }
    .highlight {
      background-color: yellow;
      cursor: pointer;
      position: relative;
    }
    .tooltip {
      visibility: hidden;
      background-color: #333;
      color: #fff;
      text-align: center;
      border-radius: 4px;
      padding: 5px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.3s;
    }
    .highlight:hover .tooltip,
    .highlight.clicked .tooltip {
      visibility: visible;
      opacity: 1;
    }
  </style>
</head>
<body>

<div id="video-container">
  <video id="video" width="800" controls>
    <source src="video.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
  <div id="subtitle-box"></div>
</div>

<script>
const tooltipDictionary = {
  "21": "His age.",
  "dance": "A type of movement.",
  "hello": "A greeting."
};

const srtUrl = 'subtitles.srt'; // URL or path to your .srt file
const subtitleBox = document.getElementById('subtitle-box');
const video = document.getElementById('video');
let subtitles = [];

function fetchSRT(url) {
  return fetch(url).then(res => res.text());
}

function parseSRT(data) {
  const pattern = /(\d+)\s+(\d{2}:\d{2}:\d{2},\d{3})\s-->\s(\d{2}:\d{2}:\d{2},\d{3})\s+([\s\S]*?)(?=\n{2,}|$)/g;
  const results = [];
  let match;
  while ((match = pattern.exec(data)) !== null) {
    results.push({
      start: srtTimeToSeconds(match[2]),
      end: srtTimeToSeconds(match[3]),
      text: match[4].replace(/\r\n|\r|\n/g, ' ')
    });
  }
  return results;
}

function srtTimeToSeconds(time) {
  const [h, m, s] = time.split(':');
  const [secs, ms] = s.split(',');
  return parseInt(h) * 3600 + parseInt(m) * 60 + parseInt(secs) + parseInt(ms) / 1000;
}

function highlightWords(text) {
  for (const word in tooltipDictionary) {
    const escapedWord = word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    const regex = new RegExp(`\\b(${escapedWord})\\b`, 'gi');
    text = text.replace(regex, (match) => {
      const tooltip = tooltipDictionary[match.toLowerCase()];
      return `<span class="highlight" onclick="showTooltip(this, event)">
                ${match}
                <span class="tooltip">${tooltip}</span>
              </span>`;
    });
  }
  return text;
}

function showTooltip(el, event) {
  event.stopPropagation();
  video.pause();
  el.classList.add('clicked');
}

function updateSubtitle() {
  const currentTime = video.currentTime;
  const currentSubtitle = subtitles.find(s => currentTime >= s.start && currentTime <= s.end);
  subtitleBox.innerHTML = currentSubtitle ? highlightWords(currentSubtitle.text) : '';
}

// Remove "clicked" class when clicking elsewhere
document.body.addEventListener('click', () => {
  document.querySelectorAll('.highlight.clicked').forEach(el => el.classList.remove('clicked'));
});

video.addEventListener('timeupdate', updateSubtitle);

// Initialize
fetchSRT(srtUrl)
  .then(data => {
    subtitles = parseSRT(data);
  });
</script>

</body>
</html>
