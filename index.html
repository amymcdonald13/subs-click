<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Interactive Subtitles with Phrases and Fetch</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      padding: 20px;
    }

    video {
      width: 100%;
      max-width: 800px;
      display: block;
      margin-bottom: 10px;
    }

    #subtitle {
      max-width: 800px;
      margin-top: 10px;
      font-size: 1.2rem;
      line-height: 1.5;
    }

    .highlight {
      color: yellow;
      cursor: pointer;
      position: relative;
    }

    .tooltip {
      visibility: hidden;
      background-color: #333;
      color: #fff;
      text-align: left;
      border-radius: 6px;
      padding: 5px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 0;
      opacity: 0;
      transition: opacity 0.3s;
      white-space: nowrap;
    }

    .highlight:hover .tooltip {
      visibility: visible;
      opacity: 1;
    }
  </style>
</head>
<body>

<video id="video" controls>
  <source src="video.mp4" type="video/mp4" />
  Your browser does not support the video tag.
</video>

<div id="subtitle"></div>

<script>
  const video = document.getElementById("video");
  const subtitleBox = document.getElementById("subtitle");

  // URL to your .srt file (must be accessible via CORS if hosted remotely)
  const srtUrl = "subtitles.srt";

  const tooltipDictionary = {
    "21": "his age",
    "my name": "stating what his name is.",
    "hello": "way to greet someone.",
    "queen": "former british monarch.",
    "dance": "A type of movement."
  };

  let subtitles = [];

  async function fetchSRT(url) {
    try {
      const response = await fetch(url);
      if (!response.ok) throw new Error("Failed to fetch subtitles");
      const text = await response.text();
      subtitles = parseSRT(text);
    } catch (err) {
      console.error("Error loading SRT file:", err);
    }
  }

  function parseSRT(data) {
    const srt = data.trim().split(/\r?\n\r?\n/);
    return srt.map(block => {
      const lines = block.split(/\r?\n/);
      const time = lines[1];
      const [start, end] = time.split(" --> ").map(t => toSeconds(t.trim()));
      const text = lines.slice(2).join(" ");
      return { start, end, text };
    });
  }

  function toSeconds(timeStr) {
    const [h, m, s] = timeStr.split(":");
    const [secs, ms] = s.split(",");
    return (
      parseInt(h) * 3600 +
      parseInt(m) * 60 +
      parseInt(secs) +
      parseInt(ms) / 1000
    );
  }

  function renderSubtitle(currentTime) {
    const current = subtitles.find(
      sub => currentTime >= sub.start && currentTime <= sub.end
    );
    if (current) {
      subtitleBox.innerHTML = processSubtitle(current.text);
    } else {
      subtitleBox.innerHTML = "";
    }
  }

  function escapeRegExp(string) {
    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  }

  function processSubtitle(text) {
    let processed = text;

    // Sort phrases by length descending to prioritize longer matches
    const sortedPhrases = Object.keys(tooltipDictionary).sort((a, b) => b.length - a.length);

    sortedPhrases.forEach(phrase => {
      const regex = new RegExp(`\\b${escapeRegExp(phrase)}\\b`, 'gi');
      processed = processed.replace(regex, match => {
        return `<span class="highlight" onclick="pauseAndShowTooltip(event)">
                  ${match}
                  <span class="tooltip">${tooltipDictionary[phrase]}</span>
                </span>`;
      });
    });

    return processed;
  }

  function pauseAndShowTooltip(event) {
    event.stopPropagation();
    video.pause();
    const tooltip = event.currentTarget.querySelector(".tooltip");
    tooltip.style.visibility = "visible";
    tooltip.style.opacity = 1;
  }

  video.addEventListener("timeupdate", () => {
    renderSubtitle(video.currentTime);
  });

  // Fetch subtitles at startup
  fetchSRT(srtUrl);
</script>

</body>
</html>
